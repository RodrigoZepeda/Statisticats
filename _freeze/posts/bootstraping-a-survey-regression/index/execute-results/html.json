{
  "hash": "0d6cc7f4b3d36bbc6a3279c07d362d98",
  "result": {
    "markdown": "---\ntitle: \"Bootstrapping a survey regression\"\ndate: \"2023-06-13\"\ncategories: [R, bootstrap, statistical-inference, survey analysis, survey]\nimage: \"boot.jpg\"\nlang: en\ndraft: false\nabstract: \"In this entry I discuss how to estimate regression coefficients using `bootstrapped` samples. This allows to calculate regressions even for cases where the `survey` function is not available.\"\ncrossref:\n  eq-prefix: equation\nformat:\n  html:\n    fig-align: center\n    code-fold: false\n---\n\n\n## Bootstrap 101\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(survey, surveybootstrap, svrep, matrixStats, modelsummary)\n```\n:::\n\n\nThe main idea behind bootstrap is that resampling the random sample allows us to generate replicates of the sampling process itself. Using these re-sampled data, we can generate our desired estimators. These estimators will be asymptotically equivalent to the desired quantities.\n\n### Bootstraping a mean\n\nAs an example, consider a random sample of `n = 1000` samples from a $Normal(0,1)$ distribution.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsamples <- rnorm(1000)\n```\n:::\n\n\nOne can estimate the mean classicaly with $\\bar{x} = \\frac{1}{n}\\sum_{i=1}^n x_i$:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmean(samples)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.008868099\n```\n:::\n:::\n\n\nThe confidence intervals are given by:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nt.test(samples)$conf.int\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] -0.05020360  0.06793979\nattr(,\"conf.level\")\n[1] 0.95\n```\n:::\n:::\n\n\nThe bootstrap estimate relies on going over several samples and calculating the mean for each of the resamples:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nresample_means <- rep(NA, 1000) #Save the mean of the re-samples\nfor (i in 1:1000){\n  resample <- sample(samples, size = 1000, replace = TRUE)\n  resample_means[i] <- mean(resample)\n}\n\n#Bootstrap estimate:\nmean(resample_means)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.009863313\n```\n:::\n:::\n\n\nThe quantiles are calculated in a similar fashion:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Bootstrap estimate:\nquantile(resample_means, c(0.025, 0.975))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n       2.5%       97.5% \n-0.04878298  0.06344128 \n```\n:::\n:::\n\n\nThese are excelent estimates of the quantity of interest!\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n## Generating bootstrap samples for surveys\n\nThere are already pre-programmed functions in the `survey` package that allow users to calculate some quantities of interest via bootstrap. In this example, we'll go through the first part of the [`survey` example vignette](https://cran.r-project.org/web/packages/survey/vignettes/survey.pdf) but with bootstrap. We'll load the data and setup the survey design, closely following the vignette:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(survey)\ndata(api)\nclus1 <- svydesign(id = ~dnum, weights = ~pw, data = apiclus1, fpc = ~fpc)\n```\n:::\n\n\nThen, we'll estimate the mean:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsvymean(~api00, clus1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n        mean     SE\napi00 644.17 23.542\n```\n:::\n:::\n\n\nTo change into bootstrap mode one has only to replicate the design\n\n\n::: {.cell}\n\n```{.r .cell-code}\nboot_clus1 <- as_bootstrap_design(clus1, type = \"Rao-Wu-Yue-Beaumont\",   \n                                  replicates = 1000)\nsvymean(~api00, boot_clus1) #Mean but now using 500 re-samples\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n        mean     SE\napi00 644.17 22.324\n```\n:::\n:::\n\n\nNotice that we had to use the design to generate the replicates. This is an important thing to keep in mind as for complex surveys one cannot simply resample without considering the design [(see this review)](http://dx.doi.org/10.1214/16-SS113).\n\n## Playing with the bootstrapped sample\n\nNow, what happens if we actually need to obtain the replicates (and use them!). For example, when implementing a model that is not already pre-programmed as part of the survey package. In that case, we'll need to use `surveybootstrap` and apply our model to the different estimates. As an example, consider replicating the following linear regression model:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nregmodel <- svyglm(api00 ~ ell + meals, design = clus1)\n\n#Create regression table\nregmodel |>\n  modelsummary(estimate = \"{estimate} [{conf.low}, {conf.high}]\", \n               statistic  = NULL, conf_level = 0.95,\n               gof_omit = c(\"IC|R|L|N|F\"),\n               title = \"Classical coefficient estimators\")\n```\n\n::: {.cell-output-display}\n```{=html}\n<div id=\"rqlkvylwna\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#rqlkvylwna table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#rqlkvylwna thead, #rqlkvylwna tbody, #rqlkvylwna tfoot, #rqlkvylwna tr, #rqlkvylwna td, #rqlkvylwna th {\n  border-style: none;\n}\n\n#rqlkvylwna p {\n  margin: 0;\n  padding: 0;\n}\n\n#rqlkvylwna .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#rqlkvylwna .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#rqlkvylwna .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#rqlkvylwna .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#rqlkvylwna .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#rqlkvylwna .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#rqlkvylwna .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#rqlkvylwna .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#rqlkvylwna .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#rqlkvylwna .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#rqlkvylwna .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#rqlkvylwna .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#rqlkvylwna .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#rqlkvylwna .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#rqlkvylwna .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#rqlkvylwna .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#rqlkvylwna .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#rqlkvylwna .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#rqlkvylwna .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#rqlkvylwna .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#rqlkvylwna .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#rqlkvylwna .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#rqlkvylwna .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#rqlkvylwna .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#rqlkvylwna .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#rqlkvylwna .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#rqlkvylwna .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#rqlkvylwna .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#rqlkvylwna .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#rqlkvylwna .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#rqlkvylwna .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#rqlkvylwna .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#rqlkvylwna .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#rqlkvylwna .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#rqlkvylwna .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#rqlkvylwna .gt_left {\n  text-align: left;\n}\n\n#rqlkvylwna .gt_center {\n  text-align: center;\n}\n\n#rqlkvylwna .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#rqlkvylwna .gt_font_normal {\n  font-weight: normal;\n}\n\n#rqlkvylwna .gt_font_bold {\n  font-weight: bold;\n}\n\n#rqlkvylwna .gt_font_italic {\n  font-style: italic;\n}\n\n#rqlkvylwna .gt_super {\n  font-size: 65%;\n}\n\n#rqlkvylwna .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#rqlkvylwna .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#rqlkvylwna .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#rqlkvylwna .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#rqlkvylwna .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#rqlkvylwna .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#rqlkvylwna .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <caption>Classical coefficient estimators</caption>\n  <thead>\n    \n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\" \"> </th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"(1)\">(1)</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"\" class=\"gt_row gt_left\">(Intercept)</td>\n<td headers=\"(1)\" class=\"gt_row gt_center\">817.182 [776.502, 857.863]</td></tr>\n    <tr><td headers=\"\" class=\"gt_row gt_left\">ell</td>\n<td headers=\"(1)\" class=\"gt_row gt_center\">-0.509 [-1.219, 0.201]</td></tr>\n    <tr><td headers=\"\" class=\"gt_row gt_left\">meals</td>\n<td headers=\"(1)\" class=\"gt_row gt_center\">-3.146 [-3.803, -2.488]</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n:::\n:::\n\nOf course, one way to do that would be via the survey replicates:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nregmodel2 <- svyglm(api00 ~ ell + meals, design = boot_clus1)\n\n#Create regression table\nregmodel2 |>\n  modelsummary(estimate = \"{estimate} [{conf.low}, {conf.high}]\", \n               statistic  = NULL, conf_level = 0.95,\n               gof_omit = c(\"IC|R|L|N|F\"),\n               title = \"Bootstrapped coefficient estimators\")\n```\n\n::: {.cell-output-display}\n```{=html}\n<div id=\"hkipzwltoq\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#hkipzwltoq table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#hkipzwltoq thead, #hkipzwltoq tbody, #hkipzwltoq tfoot, #hkipzwltoq tr, #hkipzwltoq td, #hkipzwltoq th {\n  border-style: none;\n}\n\n#hkipzwltoq p {\n  margin: 0;\n  padding: 0;\n}\n\n#hkipzwltoq .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#hkipzwltoq .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#hkipzwltoq .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#hkipzwltoq .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#hkipzwltoq .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#hkipzwltoq .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#hkipzwltoq .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#hkipzwltoq .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#hkipzwltoq .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#hkipzwltoq .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#hkipzwltoq .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#hkipzwltoq .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#hkipzwltoq .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#hkipzwltoq .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#hkipzwltoq .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#hkipzwltoq .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#hkipzwltoq .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#hkipzwltoq .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#hkipzwltoq .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#hkipzwltoq .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#hkipzwltoq .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#hkipzwltoq .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#hkipzwltoq .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#hkipzwltoq .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#hkipzwltoq .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#hkipzwltoq .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#hkipzwltoq .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#hkipzwltoq .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#hkipzwltoq .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#hkipzwltoq .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#hkipzwltoq .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#hkipzwltoq .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#hkipzwltoq .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#hkipzwltoq .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#hkipzwltoq .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#hkipzwltoq .gt_left {\n  text-align: left;\n}\n\n#hkipzwltoq .gt_center {\n  text-align: center;\n}\n\n#hkipzwltoq .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#hkipzwltoq .gt_font_normal {\n  font-weight: normal;\n}\n\n#hkipzwltoq .gt_font_bold {\n  font-weight: bold;\n}\n\n#hkipzwltoq .gt_font_italic {\n  font-style: italic;\n}\n\n#hkipzwltoq .gt_super {\n  font-size: 65%;\n}\n\n#hkipzwltoq .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#hkipzwltoq .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#hkipzwltoq .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#hkipzwltoq .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#hkipzwltoq .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#hkipzwltoq .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#hkipzwltoq .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <caption>Bootstrapped coefficient estimators</caption>\n  <thead>\n    \n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\" \"> </th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"(1)\">(1)</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"\" class=\"gt_row gt_left\">(Intercept)</td>\n<td headers=\"(1)\" class=\"gt_row gt_center\">817.182 [774.732, 859.632]</td></tr>\n    <tr><td headers=\"\" class=\"gt_row gt_left\">ell</td>\n<td headers=\"(1)\" class=\"gt_row gt_center\">-0.509 [-1.373, 0.355]</td></tr>\n    <tr><td headers=\"\" class=\"gt_row gt_left\">meals</td>\n<td headers=\"(1)\" class=\"gt_row gt_center\">-3.146 [-3.975, -2.316]</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n:::\n:::\n\n\n\nThe `surveybootstrap` package allows us to obtain a list of `data.frames` each of them representing the bootstrapped sample.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#We'll create 1000 replicates (probably should do more for your analysis)\nreplicates <- srs.bootstrap.sample(clus1, num.reps = 1000)\n```\n:::\n\n\nWe then loop through each of the estimates and compute the variables of interest. In this case, we'll compute and save the coefficients of the regression:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncoefficients <- matrix(NA, nrow = length(replicates), ncol = 3)\nfor (i in 1:length(replicates)){\n  resampled_data <-  apiclus1[replicates[[i]]$index, ]\n  model <- lm(api00 ~ ell + meals, data = resampled_data, \n              weights = resampled_data$pw*replicates[[i]]$weight.scale)\n  coefficients[i,] <- coef(model)\n}\n```\n:::\n\n\nFinally we aggregate the data:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata.frame(\"estimates\" =  coefficients |> colMeans(),\n           \"sd\" = coefficients |> colSds(),\n           \"lower_ci\"  =  coefficients |> colQuantiles(probs = 0.025),\n           \"upper_ci\"  =  coefficients |> colQuantiles(probs = 0.975)) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n    estimates       sd   lower_ci     upper_ci\n1 817.1486319 8.772412 800.259685 834.64679677\n2  -0.5157284 0.291831  -1.060651   0.05709264\n3  -3.1423897 0.197455  -3.536597  -2.74240511\n```\n:::\n:::\n\n\nAnd that's it!\n\n## Epilogue\n\nA quick note: percentile estimators of the confidence intervals are highly prevalent in the literature and seem widely accepted within the sciences (at least ecology and epidemiology). Albeit, to my knowledge, there is no final proof that these intervals work as intended. [Wu and Rao](https://www.tandfonline.com/doi/epdf/10.1080/01621459.1988.10478591?needAccess=true) argue for a different method (the `t` method). However, [Z. Mashreghi et al]((http://dx.doi.org/10.1214/16-SS113)) states: \"it is not clear that the other types of bootstrap confidence intervals (percentile or t) could be used with either of these methods since they are based on sampling schemes designed to match the variability of the estimator, but not its distribution\". ",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}